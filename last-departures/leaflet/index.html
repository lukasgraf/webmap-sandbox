<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css"><link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title></title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="js/Leaflet.VectorGrid.bundled.js"></script>
        <script src="data/Liniennetz_2.js"></script>
        <script src="data/Haltestellen_3.js"></script>
        <script>
        var m2px = 1;
        function newM2px() {
            var centerLatLng = map.getCenter();
            var pointC = map.latLngToContainerPoint(centerLatLng);
            var pointX = [pointC.x + 100, pointC.y];

            var latLngC = map.containerPointToLatLng(pointC);
            var latLngX = map.containerPointToLatLng(pointX);

            var distanceX = latLngC.distanceTo(latLngX)/100;

            reciprocal = 1 / distanceX;
            m2px = reciprocal;
        }
        function geoStyle(m) {
            return Math.ceil(m * m2px);
        }
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:true, maxZoom:28, minZoom:1
        }).fitBounds([[46.628240620503824,7.5259693219237365],[46.680157973330196,7.622147574848912]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        var layer_GoogleTerrain_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
            opacity: 1.0,
            attribution: '<a href="https://www.google.at/permissions/geoguidelines/attr-guide.html">Map data ©2015 Google</a>',
        });
        layer_GoogleTerrain_0;
        map.addLayer(layer_GoogleTerrain_0);
        var img_HeatmapIDW2400p25_1 = 'data/HeatmapIDW2400p25_1.png';
        var img_bounds_HeatmapIDW2400p25_1 = [[45.368564,5.7087031],[47.90707544,10.8566394809]];
        var layer_HeatmapIDW2400p25_1 = new L.imageOverlay(img_HeatmapIDW2400p25_1, img_bounds_HeatmapIDW2400p25_1);
        bounds_group.addLayer(layer_HeatmapIDW2400p25_1);
        map.addLayer(layer_HeatmapIDW2400p25_1);
        function pop_Liniennetz_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['LINIE'] !== null ? Autolinker.link(String(feature.properties['LINIE'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['BEZEICHN'] !== null ? Autolinker.link(String(feature.properties['BEZEICHN'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['KURSBUCH'] !== null ? Autolinker.link(String(feature.properties['KURSBUCH'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['LINIENNR'] !== null ? Autolinker.link(String(feature.properties['LINIENNR'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['TUCODE'] !== null ? Autolinker.link(String(feature.properties['TUCODE'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['TUNAME'] !== null ? Autolinker.link(String(feature.properties['TUNAME'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['TUURL'] !== null ? Autolinker.link(String(feature.properties['TUURL'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['KUBUURL'] !== null ? Autolinker.link(String(feature.properties['KUBUURL'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['SUCHNAME'] !== null ? Autolinker.link(String(feature.properties['SUCHNAME'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['STANDARD'] !== null ? Autolinker.link(String(feature.properties['STANDARD'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['LIBERO'] !== null ? Autolinker.link(String(feature.properties['LIBERO'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['BEOABO'] !== null ? Autolinker.link(String(feature.properties['BEOABO'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['LAENGE'] !== null ? Autolinker.link(String(feature.properties['LAENGE'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['TYP'] !== null ? Autolinker.link(String(feature.properties['TYP'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Shape_Leng'] !== null ? Autolinker.link(String(feature.properties['Shape_Leng'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_Liniennetz_2_0(feature) {
            switch(String(feature.properties['TYP'])) {
                case '1':
                    return {
                pane: 'pane_Liniennetz_2',
                opacity: 1,
                color: 'rgba(230,0,3,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: geoStyle(20.0),
                fillOpacity: 0,
            }
                    break;
                case '2':
                    return {
                pane: 'pane_Liniennetz_2',
                opacity: 1,
                color: 'rgba(255,221,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: geoStyle(20.0),
                fillOpacity: 0,
            }
                    break;
                case '3':
                    return {
                pane: 'pane_Liniennetz_2',
                opacity: 1,
                color: 'rgba(213,3,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: geoStyle(20.0),
                fillOpacity: 0,
            }
                    break;
                case '4':
                    return {
                pane: 'pane_Liniennetz_2',
                opacity: 1,
                color: 'rgba(69,223,58,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: geoStyle(20.0),
                fillOpacity: 0,
            }
                    break;
                case '5':
                    return {
                pane: 'pane_Liniennetz_2',
                opacity: 1,
                color: 'rgba(137,34,234,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: geoStyle(20.0),
                fillOpacity: 0,
            }
                    break;
                case '6':
                    return {
                pane: 'pane_Liniennetz_2',
                opacity: 1,
                color: 'rgba(0,12,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: geoStyle(20.0),
                fillOpacity: 0,
            }
                    break;
            }
        }
        map.createPane('pane_Liniennetz_2');
        map.getPane('pane_Liniennetz_2').style.zIndex = 402;
        map.getPane('pane_Liniennetz_2').style['mix-blend-mode'] = 'normal';
        var layer_Liniennetz_2 = new L.geoJson(json_Liniennetz_2, {
            attribution: '<a href="http://www.geo.apps.be.ch/de/geodaten/geoprodukte-zum-download-1.html?view=sheet&guid=234bfedf-94dc-1094-cdf0-ffa886f0bdfb&catalog=dlgeoproducts&type=complete">OEVTP © Amt für öffentlichen Verkehr und Verkehrskoordination</a>',
            pane: 'pane_Liniennetz_2',
            onEachFeature: pop_Liniennetz_2,
            style: style_Liniennetz_2_0,
        });
        bounds_group.addLayer(layer_Liniennetz_2);
        map.addLayer(layer_Liniennetz_2);

        // Popup function for VectorGrid layer
        // (doesn't take layer parameter, is bound with layer.bindPopup)
        function pop_Haltestellen_3(feature) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">ID</th>\
                        <td>' + (feature.properties['stop_id'] !== null ? Autolinker.link(String(feature.properties['stop_id'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Haltestelle</th>\
                        <td>' + (feature.properties['stop_name'] !== null ? Autolinker.link(String(feature.properties['stop_name'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Letzte Abfahrt</th>\
                        <td>' + (feature.properties['label'] !== null ? Autolinker.link(String(feature.properties['label'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['last_dep_scaled'] !== null ? Autolinker.link(String(feature.properties['last_dep_scaled'])) : '') + '</td>\
                    </tr>\
                </table>';
            return popupContent
        }

        function style_Haltestellen_3_0(feature) {
            switch(String(feature.properties['last_dep_scaled'])) {
                case '0':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(215,25,28,1.0)',
            }
                    break;
                case '1':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(237,110,67,1.0)',
            }
                    break;
                case '2':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(254,186,110,1.0)',
            }
                    break;
                case '3':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,232,164,1.0)',
            }
                    break;
                case '4':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(231,246,184,1.0)',
            }
                    break;
                case '5':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(183,226,168,1.0)',
            }
                    break;
                case '6':
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(116,183,174,1.0)',
            }
                    break;
                default:
                    return {
                pane: 'pane_Haltestellen_3',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(43,131,186,1.0)',
            }
                    break;
            }
        }
        map.createPane('pane_Haltestellen_3');
        map.getPane('pane_Haltestellen_3').style.zIndex = 403;
        map.getPane('pane_Haltestellen_3').style['mix-blend-mode'] = 'normal';


        function styleFuncWrapper(properties, zoom) {
            feature = {properties: properties};
            return style_Haltestellen_3_0(feature);
        };


        var layer_Haltestellen_3 = new L.vectorGrid.slicer(json_Haltestellen_3, {
            pane: 'pane_Haltestellen_3',
            attribution: '<a href="https://opentransportdata.swiss/">opentransportdata.swiss</a>',
            maxZoom: 32,

            // L.svg.tile usually works better, but can lead to some flickering with certain
            // hover effects. Using L.canvas.tile instead may help in these cases.
            rendererFactory: L.svg.tile,

            // Required for popups (click) and highlighting (hover)
            interactive: true,

            // Requires a unique feature ID in data properties
            // (Is only needed if dynamic feature style updates are needed
            // i.e. when feature highlighting is used)
            getFeatureId: function(f) {
                return f.properties.stop_id;
            },

            vectorTileLayerStyles: {
                sliced: styleFuncWrapper
            }
        });

        layer_Haltestellen_3.bindPopup(pop_Haltestellen_3, {maxHeight: 400});


        // Highlighting for VectorGrid layers
        // (requires interactive: true as a layer option)
        function highlightVectorGridFeature(e) {
            var layer = e.target;
            var feature = e.sourceTarget;
            var featureId = layer.options.getFeatureId(feature);

            // TODO: Switch case on geometry type. Only supports points for now
            var style = {
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                // XXX: fill: false leads to flickering with L.svg.tile renderer
                fill: true,
                fillOpacity: 1,
                fillColor: '#ffff00',
            };
            layer.setFeatureStyle(featureId, style);
        };

        function resetVectorGridHighlight(e) {
            var layer = e.target;
            var feature = e.sourceTarget;
            var featureId = layer.options.getFeatureId(feature);

            layer.resetFeatureStyle(featureId);

        };

        layer_Haltestellen_3.on("mouseover", highlightVectorGridFeature);
        layer_Haltestellen_3.on("mouseout", resetVectorGridHighlight);


        bounds_group.addLayer(layer_Haltestellen_3);
        map.addLayer(layer_Haltestellen_3);
        map.on("zoomend", function(e) {
            if (map.getZoom() <= 19 && map.getZoom() >= 10) {
                map.addLayer(layer_Liniennetz_2);
            } else if (map.getZoom() > 19 || map.getZoom() < 10) {
                map.removeLayer(layer_Liniennetz_2);
            }
            if (map.getZoom() <= 19 && map.getZoom() >= 12) {
                map.addLayer(layer_Haltestellen_3);
            } else if (map.getZoom() > 19 || map.getZoom() < 12) {
                map.removeLayer(layer_Haltestellen_3);
            }
        });
            if (map.getZoom() <= 19 && map.getZoom() >= 10) {
                map.addLayer(layer_Liniennetz_2);
            } else if (map.getZoom() > 19 || map.getZoom() < 10) {
                map.removeLayer(layer_Liniennetz_2);
            }
            if (map.getZoom() <= 19 && map.getZoom() >= 12) {
                map.addLayer(layer_Haltestellen_3);
            } else if (map.getZoom() > 19 || map.getZoom() < 12) {
                map.removeLayer(layer_Haltestellen_3);
            }
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: false,
            position: 'topleft',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .title += 'Search for a place';
        var baseMaps = {};
        L.control.layers(baseMaps,{'Haltestellen<br /><table><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_030018000.png" /></td><td>03:00 - 18:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_180019001.png" /></td><td>18:00 - 19:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_190020002.png" /></td><td>19:00 - 20:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_200021003.png" /></td><td>20:00 - 21:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_210022004.png" /></td><td>21:00 - 22:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_220023005.png" /></td><td>22:00 - 23:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_240003006.png" /></td><td>24:00 - 03:00</td></tr><tr><td style="text-align: center;"><img src="legend/Haltestellen_3_7.png" /></td><td></td></tr></table>': layer_Haltestellen_3,'Liniennetz<br /><table><tr><td style="text-align: center;"><img src="legend/Liniennetz_2_Bahn0.png" /></td><td>Bahn</td></tr><tr><td style="text-align: center;"><img src="legend/Liniennetz_2_Bus1.png" /></td><td>Bus</td></tr><tr><td style="text-align: center;"><img src="legend/Liniennetz_2_Nachtlinie2.png" /></td><td>Nachtlinie</td></tr><tr><td style="text-align: center;"><img src="legend/Liniennetz_2_Tram3.png" /></td><td>Tram</td></tr><tr><td style="text-align: center;"><img src="legend/Liniennetz_2_Seilbahn4.png" /></td><td>Seilbahn</td></tr><tr><td style="text-align: center;"><img src="legend/Liniennetz_2_Schiff5.png" /></td><td>Schiff</td></tr></table>': layer_Liniennetz_2,"Heatmap IDW 2400 p25": layer_HeatmapIDW2400p25_1,"Google Terrain": layer_GoogleTerrain_0,},{collapsed:false}).addTo(map);
        setBounds();
        newM2px();

            layer_Liniennetz_2.setStyle(style_Liniennetz_2_0);
        map.on("zoomend", function(){
            newM2px();

            layer_Liniennetz_2.setStyle(style_Liniennetz_2_0);
        });
        map.addControl(new L.Control.Search({
            layer: layer_Haltestellen_3,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'stop_name'}));
        document.getElementsByClassName('search-button')[0].className +=
         ' fa fa-binoculars';
        L.ImageOverlay.include({
            getBounds: function () {
                return this._bounds;
            }
        });
        </script>
    </body>
</html>
